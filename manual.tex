\documentclass[a4paper]{article}
\usepackage{graphicx}

\usepackage[  margin=2.5cm,  includefoot,  footskip=30pt,]{geometry}
\usepackage{pdflscape}
%\usepackage[cm]{fullpage}
\usepackage{bm}
\usepackage{listings}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{hyperref}
%\usepackage{xcolor}
\usepackage{mdframed}
\usepackage{makeidx} 
\usepackage{xargs}
\usepackage{upgreek}
\usepackage{algorithm,algorithmic}
\usepackage[pdftex,dvipsnames]{xcolor}
\usepackage[colorinlistoftodos,prependcaption,textsize=tiny]{todonotes}
\usepackage{amsthm}
\usepackage{gensymb} %\degree
\usepackage{siunitx} %\si{XX}
\newcommand{\aspect}{{\textsc{Aspect}}}
\newtheorem*{remark}{Remark}
%\setcounter{secnumdepth}{1} % sections are level 1

\hypersetup{
    colorlinks,
    citecolor=black,
    filecolor=black,
    linkcolor=black,
    urlcolor=black
}
\lstset{ 
  language=Python,
  backgroundcolor=\color{white},   % choose the background color; you must add \usepackage{color} or \usepackage{xcolor}; should come as last argument
  basicstyle=\footnotesize,        % the size of the fonts that are used for the code
  breakatwhitespace=false,         % sets if automatic breaks should only happen at whitespace
  breaklines=true,                 % sets automatic line breaking
  captionpos=b,                    % sets the caption-position to bottom
  frame=single,                    % adds a frame around the code
  keepspaces=true,                 % keeps spaces in text, useful for keeping indentation of code (possibly needs columns=flexible)
  keywordstyle=\color{blue},       % keyword style
}
\newcommand\norm[1]{\left\lVert#1\right\rVert}

\newcommand{\nn}{\nonumber}
\newcommand{\A}{{\mathbb{A}}}
\newcommand{\K}{{\mathbb{K}}}
\newcommand{\G}{{\mathbb{G}}}
\newcommand{\Z}{{\mathbb{Z}}}
\newcommand{\C}{{\mathbb{C}}}
\newcommand{\W}{{\mathbb{W}}}
\newcommand{\LLL}{{\mathbb{L}}}
\newcommand{\SSS}{{\mathbb{S}}}
\newcommand{\fieldstone}{{\bf fieldstone}}

\newcommandx{\unsure}[2][1=]{\todo[linecolor=red,backgroundcolor=red!25,bordercolor=red,#1]{#2}}
\newcommandx{\change}[2][1=]{\todo[linecolor=blue,backgroundcolor=blue!25,bordercolor=blue,#1]{#2}}
\newcommandx{\info}[2][1=]{\todo[linecolor=OliveGreen,backgroundcolor=OliveGreen!25,bordercolor=OliveGreen,#1]{#2}}
\newcommandx{\improvement}[2][1=]{\todo[inline,linecolor=Plum,backgroundcolor=Plum!15,bordercolor=Plum,#1]{#2}}
\newcommandx{\thiswillnotshow}[2][1=]{\todo[disable,#1]{#2}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{The Finite Element Method in Geodynamics}

\author{C. Thieulot}

\makeindex 
\begin{document}

\maketitle

\tableofcontents

\newpage

\begin{center}
{\color{red} \huge WARNING: this is work in progress}
\end{center}

%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}

\subsection{Philosophy} %------------------------------------------------------
This document was writing with my students in mind, i.e. 3rd and 4th year 
Geology/Geophysics students at Utrecht University. 
I have chosen to use as little jargon as possible unless it is a term that is 
commonly found in the geodynamics literature (methods paper as well as 
application papers). There is no mathematical proof of any theorem or statement 
I make. These are to be found in generic Numerical Analysic, Finite Element and 
Linear Algebra books. If you find that this books lacks references
to Sobolev spaces, Hilbert spaces, and other spaces, this book is just not for you.  

The codes I provide here are by no means optimised as I value code readability 
over code efficiency. I have also chosen to avoid resorting to multiple code 
files or even functions to favour a sequential reading of the codes. 
These codes are not designed to form the basis of a real life application:
Existing open source highly optimised codes shoud be preferred, such as 
ASPECT \cite{krhb12,hedg17}, CITCOM, LAMEM, PTATIN, PYLITH, ... 

All kinds of feedback is welcome on the text (grammar, typos, ...) or on the 
code(s). You will have my eternal gratitude if you wish to contribute an 
example, a benchmark, a cookbook. 

All the python scripts and this document are freely available at 
\begin{center}
\url{https://github.com/cedrict/fieldstone}
\end{center}

\subsection{Acknowledgments} %-------------------------------------------------

I have benefitted from many discussions, lectures, tutorials, coffee machine 
discussions, debugging sessions, conference poster sessions, etc ... 
over the years. I wish to name these instrumental people in particular and 
in alphabetic order: 
Wolfgang Bangerth, 
Jean Braun, 
Rens Elbertsen,
Philippe Fullsack, 
Menno Fraters, 
Anne Glerum,
Timo Heister,
Robert Myhill,
John Naliboff,
E. Gerry Puckett,
Melchior Schuh-Senlis,
Michael Tetley,
Lukas van de Wiel,
Arie van den Berg, 
Tom Weir,
and the whole ASPECT family/team. 

%I wish to acknowledge many BSc and MSc students for their questions and feedback.
%and wish to mention: Job Mos (the
%very first version of fieldstone was part of his MSc thesis), 
%Tom Weir (contributions to the compressible formulation - MSc thesis), 
%and Rens Elbertsen (Tosi benchmark - BSc thesis).


\subsection{Essential literature} %--------------------------------------------

\begin{center}
\includegraphics[height=3.74cm]{images/literature/gerya_book}
\includegraphics[height=3.74cm]{images/literature/tackley_book}
\includegraphics[height=3.74cm]{images/literature/donea_huerta_book}
\includegraphics[height=3.74cm]{images/literature/bercovici_book}
\includegraphics[height=3.74cm]{images/literature/sto_book}\\
\end{center}

http://www-udc.ig.utexas.edu/external/becker/Geodynamics557.pdf

%---------------------------------------
\subsection{Installation}

If numpy, scipy or matplotlib are not installed on your machine, here is how you 
can install them:
\begin{verbatim}
python3.6 -m pip install --user numpy scipy matplotlib
\end{verbatim}
To install the umfpack solver:
\begin{verbatim}
pip install --upgrade scikit-umfpack --user
\end{verbatim}


\subsection{What is a fieldstone?} %-------------------------------------------
Simply put, it is stone collected from the surface of fields where it 
occurs naturally. It also stands for the bad acronym: {\sl fi}nite 
{\sl el}ement {\sl d}eformation of {\sl stone}s which echoes the primary 
application of these codes: geodynamic modelling.

\subsection{Why the Finite Element method?} \input{why} %----------------------
\subsection{Notations} \input{notations} %-------------------------------------
\subsection{Colour maps for visualisation} \input{colorscale} %----------------

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{list} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The physical equations} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{physics} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The building blocks of the Finite Element Method} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Numerical integration} \label{sec:quadrature}\input{quadrature} %----------------------
\subsection{The mesh}
\subsection{A bit of FE terminology} \input{terminology} %-----------------------------------------
\subsection{Elements and basis functions in 1D} \input{elements1D} %-------------------------------
\subsection{Elements and basis functions in 2D}\label{sec:shpfct2d} \input{elements2D} %-------------------------------
\subsection{Elements and basis functions in 3D} \input{elements3D} %-------------------------------
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\newpage 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Solving the heat transport equation with linear Finite Elements} %%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{The diffusion equation in 1D} \label{sec:diff1D} \input{diff1D} %----------------------
\subsection{The advection-diffusion equation in 1D} \label{sec:advec-diff1D}\input{adv_diff1D} %---
\subsection{The advection-diffusion equation in 2D}

\input{hte_fem} %-----------------------

\newpage 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Solving the flow equations with the FEM} \label{solvingFEM} %%%%%%%%%%%%%%%%%%%%
\input{incompressible} %-----------------------------------------------------------------
\subsection{Strong and weak forms} \input{strongweak} %----------------------------------
\subsection{Which velocity-pressure pair for Stokes?} \input{pair} %---------------------
\subsection{The penalty approach for viscous flow} \input{penalty} %---------------------
\subsection{The mixed FEM for viscous flow} \input{mixed} %------------------------------
\subsection{Solving the elastic equations} %---------------------------------------------
\subsection{A quick tour of similar literature} \input{similar} %------------------------
\subsection{The case against the $Q_1\times P_0$ element} \input{case_against_q1p0} %----
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Additional techniques and features} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection{Dealing with a free surface}

\subsection{Convergence criterion for nonlinear iterations}


\newpage %-----------------------------------------------------------------------------------------
\subsection{The SUPG formulation for the energy equation} \label{sec:supg} \input{supg} %----------
\newpage %---------------------------------------------------------------------
\subsection{The method of manufactured solutions \label{mms}} \input{mms} %----
\newpage %---------------------------------------------------------------------
\subsection{Geodynamical benchmarks} \input{geodynamics_benchmarks} %----------
\newpage %---------------------------------------------------------------------
\subsection{Assigning values to quadrature points} \input{averagings} %--------
\newpage %---------------------------------------------------------------------
\subsection{Matrix (Sparse) storage} \input{storage} %-------------------------
\newpage %---------------------------------------------------------------------
\subsection{Mesh generation} \label{subsection_meshes} \input{meshes} %--------
\newpage %---------------------------------------------------------------------
\subsection{Visco-Plasticity} \input{viscoplasticity} %------------------------
\newpage %---------------------------------------------------------------------
\subsection{Pressure smoothing \label{psmoothing}} \input{pressure_smoothing} %-------------------
\newpage %---------------------------------------------------------------------
\subsection{Pressure scaling} \input{pressure_scaling} %-----------------------
\newpage %---------------------------------------------------------------------
\subsection{Pressure normalisation\label{ss_pnorm}} \input{pressure_normalisation} %--
\newpage %----------------------------------------------------------------------------
\subsection{Solving the Stokes system \label{sec:solvers}} \input{solvers} %---
\newpage %---------------------------------------------------------------------
\subsection{The consistent boundary flux (CBF)} \input{CBF} %------------------
\newpage %---------------------------------------------------------------------
\subsection{The value of the timestep} \input{cfl} %---------------------------
\newpage %---------------------------------------------------------------------
\subsection{Mappings} \input{mappings} %---------------------------------------
\newpage %---------------------------------------------------------------------
\subsection{Exporting data to vtk format} \input{exporting_to_vtk} %-----------
\newpage %---------------------------------------------------------------------
\subsection{Runge-Kutta methods} \input{rungekutta} %--------------------------
\newpage %-----------------------------------------------------------------------------------------
\subsection{Am I in or not? - finding reduced coordinates}\label{sec:amiin}\input{amiin} %---------
\newpage %---------------------------------------------------------------------
\subsection{Error measurements and convergence rates} \input{errors} %---------
\newpage %---------------------------------------------------------------------
\subsection{The initial temperature field} \input{initial_temperature} %-------
\newpage %---------------------------------------------------------------------
\subsection{Kinematic boundary conditions} \input{kinematic_bc} %--------------
\newpage %---------------------------------------------------------------------
\subsection{Computing gradients - the recovery process} \input{recovery} %-----
\newpage %---------------------------------------------------------------------
\subsection{Tracking materials and/or interfaces} \input{tracking} %-----------
\newpage %---------------------------------------------------------------------
\subsection{Static condensation} \input{static_condensation} %-----------------
\newpage %---------------------------------------------------------------------
\subsection{Measuring incompressibility \label{ss_incomp}} \input{incomp} %----
\newpage %---------------------------------------------------------------------
\subsection{Periodic boundary conditions\label{ss_periodic}}\input{periodic} %-
\newpage %---------------------------------------------------------------------
\subsection{Removing rotational nullspace\label{ss_nullspace}} \input{nullspace}
\newpage %---------------------------------------------------------------------
\subsection{Picard and Newton \label{ss_nonlinear}} \input{nonlinear} %--------
\newpage %---------------------------------------------------------------------
\subsection{Parallel or not?} \label{sec:parallel} \input{parallel}
\newpage %---------------------------------------------------------------------
\subsection{Stream function} \label{sec:streamfunction} \input{streamfunction}
\newpage %---------------------------------------------------------------------
\subsection{Corner flow} \label{sec:cornerflow} \input{cornerflow}


%\subsection{Steady state thermal problems \label{ss_ss}} \input{steadystate} %-





%==================================================================================================
%==================================================================================================

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 01: simple analytical solution (D\&H) 
\label{f01}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 01: simple analytical solution (D\&H) 
}
\input{python_codes/fieldstone_01/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 02: Stokes sphere 
\label{f02}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 02: Stokes sphere 
}
\input{python_codes/fieldstone_02/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 03: Convection in a 2D box 
\label{f03}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 03: Convection in a 2D box 
}
\input{python_codes/fieldstone_03/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 04: The lid driven cavity 
\label{f04}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 04: The lid driven cavity 
}
\input{python_codes/fieldstone_04/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 05: SolCx benchmark 
\label{f05}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 05: SolCx benchmark 
}
\input{python_codes/fieldstone_05/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 06: SolKz benchmark 
\label{f06}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 06: SolKz benchmark 
}
\input{python_codes/fieldstone_06/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 07: SolVi benchmark 
\label{f07}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 07: SolVi benchmark 
}
\input{python_codes/fieldstone_07/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 08: the indentor benchmark 
\label{f08}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 08: the indentor benchmark 
}
\input{python_codes/fieldstone_08/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 09: the annulus benchmark 
\label{f09}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 09: the annulus benchmark 
}
\input{python_codes/fieldstone_09/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 10: Stokes sphere (3D) - penalty 
\label{f10}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 10: Stokes sphere (3D) - penalty 
}
\input{python_codes/fieldstone_10/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 11: stokes sphere (3D) - mixed formulation 
\label{f11}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 11: stokes sphere (3D) - mixed formulation 
}
\input{python_codes/fieldstone_11/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 12: consistent pressure recovery 
\label{f12}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 12: consistent pressure recovery 
}
\input{python_codes/fieldstone_12/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 13: the Particle in Cell technique (1) - the effect of averaging 
\label{f13}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 13: the Particle in Cell technique (1) - the effect of averaging 
}
\input{python_codes/fieldstone_13/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 14: solving the full saddle point problem 
\label{f14}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 14: solving the full saddle point problem 
}
\input{python_codes/fieldstone_14/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 15: saddle point problem with Schur complement approach - benchmark 
\label{f15}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 15: saddle point problem with Schur complement approach - benchmark 
}
\input{python_codes/fieldstone_15/text}

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 16: saddle point problem with Schur complement approach - Stokes sphere 
\label{f16}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 16: saddle point problem with Schur complement approach - Stokes sphere 
}
\input{python_codes/fieldstone_16/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 17: solving the full saddle point problem in 3D 
\label{f17}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 17: solving the full saddle point problem in 3D 
}
\input{python_codes/fieldstone_17/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 18: solving the full saddle point problem with $Q_2\times Q_1$ elements 
\label{f18}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 18: solving the full saddle point problem with $Q_2\times Q_1$ elements 
}
\input{python_codes/fieldstone_18/text}

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 19: solving the full saddle point problem with $Q_3\times Q_2$ elements 
\label{f19}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 19: solving the full saddle point problem with $Q_3\times Q_2$ elements 
}
\input{python_codes/fieldstone_19/text}

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 20: the Busse benchmark 
\label{f20}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 20: the Busse benchmark 
}
\input{python_codes/fieldstone_20/text}

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 21: The non-conforming $Q_1 \times P_0$ element 
\label{f21}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 21: The non-conforming $Q_1 \times P_0$ element 
}
\input{python_codes/fieldstone_21/text}

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 22: The stabilised $Q_1 \times Q_1$ element 
\label{f22}} 
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 22: The stabilised $Q_1 \times Q_1$ element 
}
\input{python_codes/fieldstone_22/text}

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 23: compressible flow (1) - analytical benchmark 
\label{f23}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 23: compressible flow (1) - analytical benchmark 
}
\input{python_codes/fieldstone_23/text}

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 24: compressible flow (2) - convection box 
\label{f24}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 24: compressible flow (2) - convection box 
}
\input{python_codes/fieldstone_24/text}

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 25: Rayleigh-Taylor instability (1) - instantaneous 
\label{f25}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 25: Rayleigh-Taylor instability (1) - instantaneous 
}
\input{python_codes/fieldstone_25/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 26: Slab detachment benchmark (1) - instantaneous 
\label{f26}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 26: Slab detachment benchmark (1) - instantaneous 
}
\input{python_codes/fieldstone_26/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 27: Consistent Boundary Flux 
\label{f27}} %%%%%%%%%%%%%%%%%%%%
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 27: Consistent Boundary Flux 
}
\input{python_codes/fieldstone_27/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 28: convection 2D box - Tosi et al, 2015 
\label{f28}} %%%%%%%%
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 28: convection 2D box - Tosi et al, 2015 
}
\input{python_codes/fieldstone_28/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 29: open boundary conditions 
\label{f29}} 
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 29: open boundary conditions 
}
\input{python_codes/fieldstone_29/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 30: conservative velocity interpolation 
\label{f30}} %%%%%%%%%
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 30: conservative velocity interpolation 
}
\input{python_codes/fieldstone_30/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 31: conservative velocity interpolation 3D 
\label{f31}} %%%%%%
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 31: conservative velocity interpolation 3D 
}
%\input{python_codes/fieldstone_30/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 32: 2D analytical sol. from stream function 
\label{f32}} %%%%%
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 32: 2D analytical sol. from stream function 
}
\input{python_codes/fieldstone_32/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 33: Convection in an annulus 
\label{f33}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 33: Convection in an annulus 
}
\input{python_codes/fieldstone_33/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 34: the Cartesian geometry elastic aquarium 
\label{f34}} 
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 34: the Cartesian geometry elastic aquarium 
}
\input{python_codes/fieldstone_34/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 35: 2D analytical sol. in annulus from stream function 
\label{f35}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 35: 2D analytical sol. in annulus from stream function 
}
\input{python_codes/fieldstone_35/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 36: the annulus geometry elastic aquarium 
\label{f36}}%%%%%%%%
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 36: the annulus geometry elastic aquarium 
}
\input{python_codes/fieldstone_36/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 37: marker advection and population control 
\label{f37}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 37: marker advection and population control 
}
\input{python_codes/fieldstone_37/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 38: Critical Rayleigh number 
\label{f38}} 
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 38: Critical Rayleigh number 
}
\input{python_codes/fieldstone_38/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 39: chpe15 
\label{f39}}
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 39: chpe15 
}
\input{python_codes/fieldstone_39/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 40: Rayleigh-Taylor instability 
\label{f40}} 
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 40: Rayleigh-Taylor instability 
}
\input{python_codes/fieldstone_40/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%41 melchior

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 42: 1D diffusion 
\label{f42}} 
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 42: 1D diffusion 
}
\input{python_codes/fieldstone_42/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 43: the rotating cone 
\label{f43}} 
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 43: the rotating cone 
}
\input{python_codes/fieldstone_43/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 44: the flat slab 
\label{f44}} 
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 44: the flat slab 
}
\input{python_codes/fieldstone_44/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 45: the corner flow
\label{f45}} 
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 45: the corner flow
}
\input{python_codes/fieldstone_45/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 46: MMS1 with Crouzeix-Raviart ($P_2^+\times P_{-1}$) elements  
\label{f46}} 
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 46: MMS1 with Crouzeix-Raviart ($P_2^+\times P_{-1}$) elements  
}
\input{python_codes/fieldstone_46/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 47: MMS1 with MINI ($P_1^+\times P_1$) elements
\label{f47}} 
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 47: MMS1 with MINI ($P_1^+\times P_1$) elements
}
\input{python_codes/fieldstone_47/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{
Stone 48: D\&H with $Q_1\times P_0$, $Q_2\times Q_1$, $Q_3\times Q_2$ and $Q_4\times Q_3$ elements
\label{f48}} 
\addcontentsline{toc}{section}{\protect\numberline{} 
Stone 48: D\&H with $Q_1\times P_0$, $Q_2\times Q_1$, $Q_3\times Q_2$ and $Q_4\times Q_3$ elements
}
\input{python_codes/fieldstone_48/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{{\tt fieldstone}: Gravity: buried sphere} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{python_codes/gravity_01/text} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Problems, to do list and projects for students} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{projects} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\appendix %========================================================================================

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Three-dimensional applications} \input{threedee} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Codes in geodynamics \label{app:codes} }\input{codes} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Matrix properties} \input{matrices} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Don’t be a hero - unless you have to} \input{hero} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{A FANTOM, an ELEFANT and a GHOST} \input{mycodes} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Some useful Python commands} \input{useful_python} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Some useful maths} \input{maths} \label{app_maths} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%==================================================================================================

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bibliographystyle{plain} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\bibliography{biblio_geosciences2} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\printindex %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\listoftodos[Notes] %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\end{document}


