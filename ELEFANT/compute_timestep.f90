!==================================================================================================!
!==================================================================================================!
!                                                                                                  !
! ELEFANT                                                                        C. Thieulot       !
!                                                                                                  !
!==================================================================================================!
!==================================================================================================!

subroutine compute_timestep

use global_parameters
!use structures
!use constants
use global_measurements
use timing

implicit none

real(8) hmin,maxv

!==================================================================================================!
!==================================================================================================!
!@@ \subsubsection{compute_timestep}
!@@
!==================================================================================================!

if (iproc==0) then

call system_clock(counti,count_rate)

!==============================================================================!

maxv=max(abs(u_min),abs(u_max),abs(v_min),abs(v_max),abs(w_min),abs(w_max))

hmin=(vol_min)**(1./3.)

if (maxv>1d-15) then
   dt=CFL_nb*hmin/maxv
else
   dt=1d50
end if

if (use_T) then
   dt=min(dt,hmin**2*rhoq_min*hcapaq_min/hcondq_max)
end if

write(*,'(a,es12.4)') '        dt=',dt 







!==============================================================================!

call system_clock(countf) ; elapsed=dble(countf-counti)/dble(count_rate)

write(*,'(a,f4.2,a)') '     >> compute_timestep ',elapsed,' s'

end if ! iproc

end subroutine

!==================================================================================================!
!==================================================================================================!
